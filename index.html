<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>BlueDriving</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="style.css">
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

	<!-- This is to add the basic information in the main web page. -->
	<script type="text/javascript">
		$(document).ready(function(){

		function utf8_decode (str_data) {
			var newstring = str_data.replace(/\\x/g,"%");
		  	return decodeURI(newstring);
		}



		// Returns a sanitized version of text
		function esc( text ) {
			return text
				.replace( '&', '&amp;' )
				.replace( '<', '&lt;' )
				.replace( '>', '&gt;' )
			}


		function fillTable( devices ) {
			var e = esc;
			var html = [], h = -1;
			html[++h] = '<tbody>';
			for ( var device, i = -1; device = devices[++i]; ) {
				html[++h] = '<tr><td class="date">';
				html[++h] = e(device.lastseen);
				html[++h] = ' ';
				html[++h] = '</td><td class="mac">';
				html[++h] = e(device.mac);
				html[++h] = ' ';
				html[++h] = '</td><td class="position">';
				html[++h] = e(device.gps);
				html[++h] = ' ';
				html[++h] = '</td><td class="address">';
				//html[++h] = utf8_decode(e(device.address));
				html[++h] = utf8_decode(e(device.address));
				html[++h] = ' ';
				html[++h] = '</td><td class="name">';
				html[++h] = e(device.name);
				html[++h] = '</td></tr>';
				}
			html[++h] = '</tbody>';
			//$('#hor-zebra')[0].innerHTML = html.join('');
			$('#hor-zebra').append(html.join(''));
			}


			$.getJSON("http://localhost:8000/data", {}, function(data) {
				fillTable( data.UnReadData );	
				changeColors();
				addClicks();
				});
			


		// Change the colors of the table
		function changeColors () {
			$('#hor-zebra tr:odd').addClass('odd');
		};

		//Add the click event 
		function addClicks () {
			//$('#hor-zebra tr').click( function(){ alert('Clickeaste el item con nombre ' + $('#hor-zebra tr')[$('#hor-zebra tr').index(this)].cells[3].innerHTML);    });
			$('#hor-zebra tr').click( function(){ 
						// First de-select rows
						$('#hor-zebra tr').removeClass('selected') 
						// second select rows
						$('#hor-zebra tr:eq('+$('#hor-zebra tr').index(this)+')').addClass('selected') 
						});
		};


		}); // Ends of ready function
	</script>

    </head>
    <body>
        <div id='header' style='width:900px'>
            <ul>
                <li><a href="#"><img src="img/icon-list.png"></br>Results</a></li>
                <li><a href="#"><img src="img/icon-devices.png"></br>Devices</a></li>
                <li><a href="#"><img src="img/icon-map.png"></br>Map</a></li>
                
            </ul>
        </div>
        <div id='contentbox' style='width:900px'>
		<table id="hor-zebra" summary="" style='width:900px'>
			<thead>
			    <tr>
				<th scope="col">DATE</th>
				<th scope="col">MAC ADDRESS</th>
				<th scope="col">GLOBAL POSITION</th>
				<th scope="col">ADDRESS</th>
				<th scope="col">NAME</th>
			    </tr>
			</thead>
		</table>
        </div>
    </body>
</html>
